.. _intersect:arch:examples:aam:sos:

System-of-Systems Architecture
------------------------------

.. _intersect:arch:examples:aam:sos:physical:

Physical View
=============

The :term:`INTERSECT` :term:`AAM` system is deployed at :term:`Oak Ridge
National Laboratory's (ORNL's) <ORNL>` :term:`Manufacturing Demonstration
Facility (MDF)<MDF>`, :term:`Spallation Neutron Source (SNS)<SNS>`, and
:term:`Oak Ridge Leadership Computing Facility (OLCF)<OLCF>` as a
cross-facility instrument-science workflow. The :term:`INTERSECT`
:term:`AAM`\'s :ref:`intersect:arch:sos:physical` contains the following
components (:numref:`intersect:arch:examples:aam:sos:physical:components`):

- The 3D metal printer with its control computer, both located at the
  :term:`MDF`.

- The :term:`OLCF` :term:`Advanced Computing Ecosystem (ACE)<ACE>` testbed
  computer used for the thermomechanical simulation in the
  :ref:`intersect:arch:pat:catalog:architectural:distributed_steering`
  architectural pattern's feedback loop of the 3D metal printing process.

- The :term:`SNS` with its neutron beam experiment and corresponding neutron
  diffraction sensors.

- The :term:`SNS` Analysis cluster computer used for the analysis of the
  neutron diffraction data that is used for validation.

- The domain expert computer used for experiment planning of the 3D metal
  printing process.

These physical components interact with each other as follows
(:numref:`intersect:arch:examples:aam:sos:physical:components`):

- The experiment plan is created by a domain expert on the domain expert
  computer.

- The experiment plan is transferred from the domain expert computer to the 3D
  metal printer control computer, crossing the :term:`ORNL` to :term:`MDF`
  facility/network boundary.

- During the 3D metal printing process, thermocouple sensor data and infrared
  images are transferred from the 3D metal printer control computer to the
  :term:`OLCF` :term:`ACE` testbed computer used for the thermomechanical
  simulation in the
  :ref:`intersect:arch:pat:catalog:architectural:distributed_steering`
  architectural pattern's feedback loop, crossing the :term:`MDF` to
  :term:`OLCF` facility/network boundary. The data transfer is automated and
  the execution of the thermomechanical simulation is triggered by the data
  transfer.

- During the 3D metal printing process, thermomechanical simulation results
  that modulate the printing process are transferred from the :term:`OLCF`
  :term:`ACE` testbed computer to the 3D metal printer control computer in
  the :ref:`intersect:arch:pat:catalog:architectural:distributed_steering`
  architectural pattern's feedback loop, crossing the :term:`OLCF` to
  :term:`MDF` facility/network boundary. The data transfer is automated and the
  modulation of the printing process is triggered by the data transfer.

- The 3D printed metal structure is physically transferred from the :term:`MDF`
  facility to the :term:`SNS` for neutron beam experiments to collect ex-situ
  neutron diffraction data. In an alternative experimental setup, the 3D
  printing process is performed at the :term:`SNS` in the live neutron beam,
  collecting in-situ neutron diffraction data.

- The neutron diffraction data generated by the :term:`SNS` facility is
  transferred to the :term:`SNS` Analysis cluster computer as part of the
  :ref:`intersect:arch:pat:catalog:architectural:distributed_design`
  architectural pattern's feedback loop. The data transfer is automated.

- The neutron diffraction analysis results are transferred from the :term:`SNS`
  Analysis cluster computer used for analyzing the neutron diffraction data to
  the domain expert computer used for experiment planning of the 3D metal
  printing process as part of the
  :ref:`intersect:arch:pat:catalog:architectural:distributed_design`
  architectural pattern's feedback loop, crossing the :term:`OLCF` to
  :term:`ORNL` facility/network boundary. The data transfer can be automated
  and the execution of the analysis can be triggered by the data transfer.

.. figure:: sos/physical.png
   :name: intersect:arch:examples:aam:sos:physical:components
   :align: center

   Physical components of the :term:`INTERSECT` :term:`AAM` system and their
   interactions

.. _intersect:arch:examples:aam:sos:logical:

Logical View
============

In the :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:logical`, the
physical components are abstracted as iteracting :term:`INTERSECT`
infrastructure systems as follows
(:numref:`intersect:arch:examples:aam:sos:physical:systems`):


- **Additive Manufacturing System:** The 3D metal printer with its control
  computer at the :term:`MDF`.

- **Experiment Steering Analysis System:** The :term:`OLCF` :term:`ACE` testbed
  computer used for the thermomechanical simulation.

- **Spallation Neutron Source System:** The :term:`SNS` with its neutron beam
  experiment and corresponding neutron diffraction sensors.

- **Design of Experiments Analysis System:** The :term:`SNS` Analysis cluster
  computer used for the analysis of the neutron diffraction data.

- **Experiment Planning System:** The domain expert computer used for experiment
  planning.

.. figure:: sos/systems.png
   :name: intersect:arch:examples:aam:sos:physical:systems
   :align: center

   Infrastructure systems of the :term:`INTERSECT` :term:`AAM` system and their
   interactions

The :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:logical` also
maps :ref:`intersect:arch:sos:logical:systems` to the infrastructure systems,
with logical systems spanning over one or more infrastructure systems and the
intersection of logical and infrastructure systems providing services as
follows:

.. list-table:: Mapping of the :term:`INTERSECT` :term:`AAM` system's
                ':ref:`intersect:arch:sos:logical:systems`
   :name: intersect:arch:examples:aam:sos:logical:mapping
   :align: center

   * - **Logical \\ Infrastructure System**
     - **Additive Manufacturing System**
     - **Experiment Steering Analysis System**
     - **Spallation Neutron Source System**
     - **Design of Experiments Analysis System**
     - **Experiment Planning System**
   * - :ref:`intersect:arch:sos:logical:systems:ims`
     - - System Management Service
       - Instrument Service
     - - System Management Service
       - Steering Analysis Service
       - Compute Service
     - - System Management Service
       - Instrument Service
     - - System Management Service
       - Design Analysis Service
       - Compute Service
     - - System Management Service
   * - :ref:`intersect:arch:sos:logical:systems:ums`
     - - User Authentication Service
       - User Authorization Service
     - - User Authentication Service
       - User Authorization Service
     - - User Authentication Service
       - User Authorization Service
     - - User Authentication Service
       - User Authorization Service
     - - User Authentication Service
       - User Authorization Service
   * - :ref:`intersect:arch:sos:logical:systems:ors`
     -
     -
     -
     -
     -
   * - :ref:`intersect:arch:sos:logical:systems:dms`
     - - Data Management Service
       - Data Repository Service
     - - Data Management Service
     - - Data Management Service
       - Data Repository Service
     - - Data Management Service
     - - Data Management Service
   * - :ref:`intersect:arch:sos:logical:systems:cms`
     -
     -
     -
     -
     -
   * - :ref:`intersect:arch:sos:logical:systems:cs`
     - - Point-to-point Messaging
     - - Point-to-point Messaging
     - - Point-to-point Messaging
     - - Point-to-point Messaging
     - - Point-to-point Messaging

Data View
=========

.. _intersect:arch:examples:aam:sos:data:

The :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:data` consists of
the :ref:`intersect:arch:examples:aam:sos:data:operational` necessary to
function in the :term:`INTERSECT` ecosystem and the
:ref:`intersect:arch:examples:aam:sos:data:experimental` needed for performing
and resulting from the :term:`AAM` experiment.

.. _intersect:arch:examples:aam:sos:data:operational:

Operational Data
^^^^^^^^^^^^^^^^

In general, :term:`INTERSECT` operational data is organized according to
the :ref:`intersect:arch:sos:data:erdm` in the :term:`INTERSECT`
:ref:`intersect:arch:sos:data`. The :term:`INTERSECT` :term:`AAM` system's
resources, users, experiments, and campaigns are part of the
experiment-specific operational data model.

For example, adding a user to the :term:`INTERSECT` :term:`AAM` system results
in the addition of instances of the ``User`` and ``User Profile`` entities. The
domain expert may create a number of related experiments; the relationship
between them might be captured as one or more instances of the ``Campaign``
entity, with the eventual creation of appropriate ``Campaign Result``,
``Campaign Error``, and/or ``Campaign Template`` instances.

The physical components utilized in the :term:`INTERSECT` :term:`AAM` system,
such as the 3D metal printer and its controller computer, are defined as
resources with corresponding instances of the ``Resource`` entity. The
:term:`INTERSECT` :term:`AAM` system interacts with other, previously-defined
resources within the ecosystem, such as the :term:`OLCF` :term:`ACE` testbed
computer and the :term:`SNS` Analysis cluster computer that have been defined
by their administrators/owners and are available to the :term:`AAM` system as
part of the :term:`INTERSECT` ecosystem.

.. _intersect:arch:examples:aam:sos:data:experimental:

Experimental Data
^^^^^^^^^^^^^^^^^

The following data artifacts are generated and/or managed as experimental data
by the :term:`INTERSECT` :term:`AAM` system:

Experiment Design Plan
   The experiment design plan describes the goal, which is the validated 3D
   printing of a metal part with predetermined structural stresses. It is
   modified and improved as part of the
   :ref:`intersect:arch:pat:catalog:architectural:distributed_design`
   architectural pattern's feedback loop. The initial and subsequent plans are
   stored in a repository.

Experiment Plan
   The experiment plan is the sequence of predetermined steps and associated
   parameters necessary to 3D print the metal part. The parameters include the
   targeted structural stress and the options for changing the laser
   parameters, such as temperature and speed. It is a
   :term:`comma-separated values format (CSV)<CSV>` file with a file size in
   the kilobyte range. The experiment plans are stored in a repository.

:term:`IR` Data
   The :term:`IR` data are processed :term:`IR` camera images with :term:`IR`
   data points spatially mapped to the 3D printed structure. Each processed
   image is a :term:`CSV` file with a file size in the kilobyte range.

Thermocouple Data
   The thermocouple data are the measured temperature values at the base of the
   3D printed structure and :term:`CSV` files with a file size in the kilobyte
   range.

Sample Metadata
   This data describes the printed sample for an experiment.

Neutron Diffraction Data
   The neutron diffraction data is stored in a :term:`X-ray diffraction
   (XRD)<XRD>` file. It is available on the :term:`SNS` Analysis cluster
   computer after the experiment is finished.

.. _intersect:arch:examples:aam:sos:operational:

Operational View
================

The :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:operational`
describes tasks and procedures from the viewpoint of real-world operations
stakeholders. The intent is to capture practical constraints and procedures
for the operation and use of the additive manufacturing equipment.

The :term:`INTERSECT` :term:`AAM` system has two experimental setups. The
primary setup runs the :term:`AM` process at the :term:`MDF` and uses the
:term:`SNS` to collect ex-situ neutron diffraction data. The secondary setup
runs the :term:`AM` process at the :term:`SNS` in the live neutron beam,
collecting in-situ neutron diffraction data, using a more mobile 3D printer
and a containment environment. Both setups employ thermocouple sensors and
:term:`IR` cameras. These two setups include the following operational
aspects that impact the :term:`AM` process depicted in
:numref:`intersect:arch:examples:aam:sos:operational:process`:

- The :term:`IR` camera can be moved from the primary setup at the :term:`MDF`
  to the secondary setup at the :term:`SNS`, requiring spatial recalibration.

- The thermomechanical simulation can run on a variety of hardware platforms,
  using either local or remote (to the 3D printer) computational resources.

- Beam time at the :term:`SNS` requires specific resource allocations and
  availability is limited.

.. figure:: sos/aam-process.png
   :name: intersect:arch:examples:aam:sos:operational:process
   :align: center

   Operational steps of the :term:`AM` process

The thermo-mechanical simulation (i.e., :term:`ADAMANTINE`) is often run using
process containers (e.g., `Docker <https://https://www.docker.com>`_), which
helps to streamline the setup and execution. These simulations can run on the
edge computer at the :term:`MDF`, on the :term:`OLCF` :term:`ACE` testbed, or
even on the :term:`SNS` Analysis cluster computer. The autonomous adaptive control
(via :term:`ADAMANTINE`) steers the operational parameters for the 3D printing
process, based on information gathered from the thermocouple sensors and
:term:`IR` camera. The `Robot Operating System (ROS) <https://www.ros.org>`_
software environment on the 3D metal printer control computer controls the
printing process and coordinates the overall set of actions. The
visualization/dashboard runs via :term:`ROS` and offers real-time information.
An operator (human) is responsible for monitoring the printing process for
safety reasons, with phsical "kill switches" to abort if needed.

The `Okuma MU-8000V Laser EX
<https://www.okuma.com/products/mu-8000v-laser-ex>`_ device used in the
:term:`AM` process includes both, a laser for additive procedures (i.e.,
for melting and depositing metal powder) and a milling tool for subtractive
machining (:numref:`intersect:arch:examples:aam:sos:operational:okuma`). The
device can only use one mode at a time, additive or subtractive. A close-up
view of the platform, camera, and laser head are shown in
:numref:`intersect:arch:examples:aam:sos:operational:okuma-zoom`.

.. figure:: sos/mdf-okuma-1849.jpg
   :name: intersect:arch:examples:aam:sos:operational:okuma
   :align: center
   :width: 600

   The Okuma MU-8000V Laser EX device and its control station. The milling
   platform in the center is in a level position but can rotate as needed. The
   laser head is to the right (gold tip) and the thermal camera is to the left
   (plastic cover).

.. figure:: sos/mdf-okuma-zoom-1848.jpg
   :name: intersect:arch:examples:aam:sos:operational:okuma-zoom
   :align: center
   :width: 400

   Closer view of the milling platform, laser head (right - gold tip)
   and thermal camera (left - plastic cover).

.. _intersect:arch:examples:aam:sos:user:

User View
=========

The :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:user` defines the
roles of human actors, the processes implemented by the :term:`INTERSECT`
architecture to support those roles, and the user interfaces necessary to
support those roles.

.. _intersect:arch:examples:aam:sos:user:roles:

Roles
^^^^^

The primary human actor in the :term:`INTERSECT` :term:`AAM` system is the
:term:`domain expert (DE)<DE>`. This actor is responsible for conceiving the
autonomous experiment, creating the experiment design plan and experiment plan,
and submitting the plans to the corresponding systems. Depending on the
structure of the :term:`AAM` project team, the :term:`DE` may fill multiple
:ref:`intersect:arch:sos:user:roles`:

User
   The :term:`DE` plans and executes a number of different :term:`AAM`
   experiments.

Maintainer/Operator
   The :term:`DE` may be responsible for maintenance of the domain expert
   computer, the 3D metal printer, or the 3D metal printer controller computer.
   Other resources, such as the :term:`ACE` testbed and the :term:`SNS` Analysis
   cluster computer have their own designated maintainers/operators.

Administrator
   The :term:`DE` may be responsible for approving new resources (e.g.,
   replacing the domain expert computer with a more recent or capable machine).
   Other resources, such as the :term:`ACE` testbed and the :term:`SNS` Analysis
   cluster computer have their own designated administrators.

Owner:
   The :term:`DE` may be an owner of resources for the purposes of accounting
   or other fiscal responsibilities. Other resources, such as the :term:`ACE`
   testbed and the :term:`SNS` Analysis cluster computer have their own
   designated owners.

Provider
   The :term:`DE` does not fill this role. Other resources, such as the
   :term:`ACE` testbed and the :term:`SNS` Analysis cluster computer have
   their own designated providers.
   
.. _intersect:arch:examples:aam:sos:user:processes:

Processes
^^^^^^^^^

The :ref:`intersect:arch:sos:user:processes` implemented by :term:`INTERSECT`
:term:`AAM` system may include some combination of the following, among others:

:ref:`Login<intersect:arch:sos:user:processes:process-login>`
   As part of conducting an :term:`INTERSECT` :term:`AAM` experiment, the
   :term:`DE` logs into the :term:`INTERSECT` user interface.

:ref:`Compile DAG<intersect:arch:sos:user:processes:process-compile>`
   The :term:`DE` uses the :term:`INTERSECT` user interface to assemble the
   necessary resources to accomplish an :term:`AAM` experiment.

:ref:`Request resources<intersect:arch:sos:user:processes:process-request>`
   The physical resources depicted in
   :numref:`intersect:arch:examples:aam:sos:physical:components`
   are represented in :term:`INTERSECT` as resources and need to be allocated
   as part of the experiment setup.

:ref:`Trigger workflow<intersect:arch:sos:user:processes:trigger>`
   When the resources for the experiment have been allocated and mapped to the
   created :term:`DAG`, the :term:`INTERSECT` :term:`AAM` experiment workflow
   is triggered and executed.

.. _intersect:arch:examples:aam:sos:user:interfaces:

User Interfaces
^^^^^^^^^^^^^^^

Multiple user interfaces will be used by the :term:`DE` as part of executing
:term:`AAM` experiments. Administrative user interfaces will allow the
:term:`DE` to coordinate other users and resources. In the operator role, the
:term:`DE` will complete tasks such as
:ref:`monitoring resources<intersect:arch:sos:user:interfaces:operator:monitorsresource>`,
:ref:`setting up resources<intersect:arch:sos:user:interfaces:operator:setupresource>`,
and :ref:`updating resource information and configuration<intersect:arch:sos:user:interfaces:operator:updatesresource>`.
In the owner role, the :term:`DE` will make use of interfaces to
:ref:`edit resource configurations<intersect:arch:sos:user:interfaces:owner:editsconfiguration>`,
manage :ref:`user permissions and roles<intersect:arch:sos:user:interfaces:owner:managespermissions>`, and
:ref:`view the resources<intersect:arch:sos:user:interfaces:owner:viewslisting>`
that the :term:`DE` owns. The user role will expose the largest selection of
user interfaces to the :term:`DE`, with tasks ranging from
:ref:`applying<intersect:arch:sos:user:interfaces:user:applyaccount>`
for an :term:`INTERSECT` account, to
:ref:`editing user profiles<intersect:arch:sos:user:interfaces:user:profile>`, to
:ref:`creating<intersect:arch:sos:user:interfaces:user:createcampaign>`,
:ref:`starting<intersect:arch:sos:user:interfaces:user:steercampaign>`, and
:ref:`steering<intersect:arch:sos:user:interfaces:user:steercampaign>`
a campaign of :term:`AAM` experiments.

.. _intersect:arch:examples:aam:sos:standards:

Standards View
==============

The :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:standards`
consists of :ref:`intersect:arch:examples:aam:sos:standards:internal` and
:ref:`intersect:arch:examples:aam:sos:standards:external`.

.. _intersect:arch:examples:aam:sos:standards:internal:

Internal Standards
^^^^^^^^^^^^^^^^^^

The :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:standards`
consists of the following :ref:`intersect:arch:sos:standards:internal`:

- :ref:`intersect:arch:sos:logical`
   - :ref:`intersect:arch:sos:logical:systems`
      - Minimum requirement: :ref:`Infrastructure Management System<intersect:arch:sos:logical:systems:ims:minimum>`
      - Minimum requirement: :ref:`User Management System<intersect:arch:sos:logical:systems:ums:minimum>`
      - Minimum requirement: :ref:`Orchestration System<intersect:arch:sos:logical:systems:ors:minimum>`
      - Minimum requirement: :ref:`Data Management System<intersect:arch:sos:logical:systems:dms:minimum>`
      - Minimum requirement: :ref:`Campaign Management System<intersect:arch:sos:logical:systems:cms:minimum>`
      - Minimum requirement: :ref:`Communication System<intersect:arch:sos:logical:systems:cs:minimum>`
   - Minimum requirement: :ref:`Apapters<intersect:arch:sos:logical:adapters:minimum>`
   - :ref:`intersect:arch:sos:logical:errors`
      - Minimum requirement: :ref:`Detection<intersect:arch:sos:logical:errors:detection:minimum>`
      - Minimum requirement: :ref:`Notification<intersect:arch:sos:logical:errors:notification:minimum>`
      - Minimum requirement: :ref:`Handling<intersect:arch:sos:logical:errors:handling:minimum>`
- :ref:`intersect:arch:sos:user`
   - Minimum requirement: :ref:`User Roles<intersect:arch:sos:user:roles:minimum>`

.. _intersect:arch:examples:aam:sos:standards:external:

External Standards
^^^^^^^^^^^^^^^^^^

The :term:`INTERSECT` :term:`AAM`\'s :ref:`intersect:arch:sos:standards`
consists of the following :ref:`intersect:arch:sos:standards:external`:

.. admonition:: Requirement
   :name: intersect:arch:examples:aam:sos:standards:external:printer

   `Okuma MU-8000V Laser EX
   <https://www.okuma.com/products/mu-8000v-laser-ex>`_\: The `Okuma MU-8000V
   Laser EX <https://www.okuma.com/products/mu-8000v-laser-ex>`_ is a 3D metal
   printer combines the latest laser additive technology with subtractive
   machining capabilities. It is a multitasking :term:`computer numerical
   control (CNC) <CNC>` machine that implements :term:`laser metal deposition
   (LMD)<LMD>` technology with the ability to cut unique parts of many
   different sizes and shapes. :term:`LMD` supplies powder from nozzles and
   performs laser melting and bonding to the parent material.

.. admonition:: Requirement
   :name: intersect:arch:examples:aam:sos:standards:external:ros

   `Robot Operating System (ROS) <https://www.ros.org>`_\: :term:`ROS`
   :cite:`ROS-software` is a set of Linux-based software libraries and tools
   for robot applications. It is deployed on the 3D metal printer control
   computer.

.. admonition:: Requirement
   :name: intersect:arch:examples:aam:sos:standards:external:ace

   `OLCF ACE Testbed
   <https://docs.olcf.ornl.gov/ace_testbed/>`_\: The :term:`ACE` testbed
   :cite:`olcf:ace` is a unique :term:`OLCF` capability that provides a
   sandboxed area for deploying computing and data resources and facilitating
   the evaluation of diverse workloads, including for :term:`INTERSECT` and
   :term:`IRI`. It is used to run the :term:`ADAMANTINE` thermomechanical
   simulation.

.. admonition:: Requirement
   :name: intersect:arch:examples:aam:sos:standards:external:adamantine

   `ADAMANTINE
   <https://github.com/adamantine-sim/adamantine>`_\: :term:`ADAMANTINE`
   :cite:`adamantine-software` is open-source sofware to simulate heat
   transfer for additive manufacturing. It is deployed on the :term:`OLCF`
   :term:`ACE` testbed computer used for the thermomechanical simulation.

.. admonition:: Requirement
   :name: intersect:arch:examples:aam:sos:standards:external:sns_vulcan

   `SNS VULCAN Engineering Materials Diffractometer
   <https://neutrons.ornl.gov/vulcan>`_ : The `SNS VULCAN Engineering Materials
   Diffractometer <https://neutrons.ornl.gov/vulcan>`_ :cite:`SNS:VULCAN` is
   designed for deformation, phase transformation, residual stress, texture,
   and microstructure studies. It is an instrument that has unique scientific
   capabilities, its own control software, and generates the needed neutron
   diffraction data in its own data formats.

.. admonition:: Requirement
   :name: intersect:arch:examples:aam:sos:standards:external:sns_analysis

   `SNS Analysus cluster computer <https://analysis.sns.gov/>`_\: The `SNS
   Analysus cluster computer <https://analysis.sns.gov/>`_ is located at the
   :term:`SNS` and specifically designated for analyzing neutron diffraction
   data from the :term:`SNS`.
